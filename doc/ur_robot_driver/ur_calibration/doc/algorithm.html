<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calibration correction algorithm &mdash; Universal Robots ROS 2 Documentation 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />

  
    <link rel="shortcut icon" href="../../../../_static/logo.png"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=2709fde1"></script>
        <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../../_static/copybutton.js?v=6dbb43f8"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="ur_controllers" href="../../ur_controllers/doc/index.html" />
    <link rel="prev" title="Usage" href="usage.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Universal Robots ROS 2 Documentation
              <img src="../../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../ur_client_library/doc/index.html">ur_client_library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ur_description/doc/index.html">ur_description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ur_robot_driver/doc/index.html">ur_robot_driver</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ur_calibration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Calibration correction algorithm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ur_controllers/doc/index.html">ur_controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ur_moveit_config/doc/index.html">ur_moveit_config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ur_tutorials/doc/tutorial_index.html">Tutorial examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../migration_notes.html">Migration Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Universal Robots ROS 2 Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">ur_calibration</a></li>
      <li class="breadcrumb-item active">Calibration correction algorithm</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/UniversalRobots/Universal_Robots_ROS2_Documentation/blob/main//doc/ur_robot_driver/ur_calibration/doc/algorithm.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="calibration-correction-algorithm">
<h1>Calibration correction algorithm<a class="headerlink" href="#calibration-correction-algorithm" title="Link to this heading"></a></h1>
<p>When extracting the robot’s calibration there will be a set of Denavit–Hartenberg (DH) parameters
describing the robot. Due to the calibration process they can seem a bit unintuitive since the
<code class="docutils literal notranslate"><span class="pre">d</span></code>-parameter of the second and third joint can be quite large on those.</p>
<p>For example, let’s consider the following dh parameters taken from a real robot:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">#          joint1                  joint2               joint3                joint4               joint5                joint6</span>
<span class="nt">dh_theta</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">-2.4147806894359e-07    1.60233952386695     -1.68607190752171     0.0837331147700119   -1.01260355871158e-07 3.91986209186124e-08</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="nt">dh_a</span><span class="p">:</span><span class="w">     </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">2.12234865571206e-05   0.0193171326277006   -0.569251663611088   -4.61409023720934e-05 -6.39280053471802e-05 0</span><span class="w">                    </span><span class="p p-Indicator">]</span>
<span class="nt">dh_d</span><span class="p">:</span><span class="w">     </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">0.180539811714259    439.140974079901     -446.027059806332       7.0603368964236       0.119811341150314    0.115670917257426</span><span class="w">    </span><span class="p p-Indicator">]</span>
<span class="nt">dh_alpha</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">1.57014608044242       0.0013941666682559    0.00693818880325995  1.56998468543761     -1.57038520649543     0</span><span class="w">                    </span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>One can see that the upper arm is placed 439 m out of the base link with the lower arm being 7 m to
the other side.</p>
<p>We can build a robot description that splits each DH segment into two links: One for <code class="docutils literal notranslate"><span class="pre">d</span></code> and
<code class="docutils literal notranslate"><span class="pre">theta</span></code> representing the rotational part of the joint and one for <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">alpha</span></code>
representing the “passive” part of the joint displacing the next link.
<a class="reference internal" href="#calibration-example"><span class="std std-numref">Fig. 1</span></a> shows (a part of) the description matching the parameters above. The
arm links are left out of the image as they are really far away.</p>
<figure class="align-default" id="id1">
<span id="calibration-example"></span><img alt="Example of a calibrated model" src="../../../../_images/calibration_example.png" />
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">This shows an example calibrated model when using the DH parameters directly as explained above.
The two arm links are virtually displaced very far from the physical robot while the TCP ends up
at the correct location again</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>For explaining the correction algorithm, we will use an artificial set of DH parameters for a
UR10e:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">#          join1       joint2  joint3  joint4       joint5      joint6</span>
<span class="nt">dh_theta</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0           0       0       0            0           0</span><span class="w">      </span><span class="p p-Indicator">]</span>
<span class="nt">dh_a</span><span class="p">:</span><span class="w">     </span><span class="p p-Indicator">[</span><span class="nv">0          -0.6127 -0.57155 0            0           0</span><span class="w">      </span><span class="p p-Indicator">]</span>
<span class="nt">dh_d</span><span class="p">:</span><span class="w">     </span><span class="p p-Indicator">[</span><span class="nv">0.1807      1       0.5    -1.32585      0.11985     0.11655</span><span class="p p-Indicator">]</span>
<span class="nt">dh_alpha</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1.570796327 0.2     0       1.570796327 -1.570796327 0</span><span class="w">      </span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>The resulting uncorrected model can be seen in <a class="reference internal" href="#calibration-uncorrected"><span class="std std-numref">Fig. 2</span></a>. The upper arm is
placed 1 m to the left of the shoulder, the upper arm is placed 0.5 m further out and there’s an
added <code class="docutils literal notranslate"><span class="pre">alpha</span></code> rotation in joint2.</p>
<p>Note: This is not a valid calibration, so when placing this “calibration” on a robot and using the
correction, we won’t get correct tcp pose results. This only serves as a exaggerated example.</p>
<figure class="align-default" id="id2">
<span id="calibration-uncorrected"></span><img alt="Exaggerated calibrated model" src="../../../../_images/calibration_uncorrected.png" />
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">This shows an artificial calibration only to show the algorithm. This is no valid calibration!</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>In <a class="reference internal" href="#calibration-uncorrected"><span class="std std-numref">Fig. 2</span></a> the separation between the two DH components can be seen quite
clearly. joint2’s <code class="docutils literal notranslate"><span class="pre">d</span></code> and <code class="docutils literal notranslate"><span class="pre">theta</span></code> parameters are represented by <code class="docutils literal notranslate"><span class="pre">upper_arm_d</span></code> and its <code class="docutils literal notranslate"><span class="pre">a</span></code>
and <code class="docutils literal notranslate"><span class="pre">alpha</span></code> parameters result in <code class="docutils literal notranslate"><span class="pre">upper_arm_a</span></code>.</p>
<p>The “correction” step tries to bring the two arm segments back to their physical representation.
In principle, the d parameter to zero, first. With this change,
the kinematic structure gets destroyed, which has to be corrected:</p>
<ul class="simple">
<li><p>With setting <code class="docutils literal notranslate"><span class="pre">d</span></code> to 0, both the start (<code class="docutils literal notranslate"><span class="pre">upper_arm_d</span></code>) and end (<code class="docutils literal notranslate"><span class="pre">upper_arm_a</span></code>) points of the
passive segment move along the joint’s rotational axis. Instead, the end point of the passive
segment has to move along the rotational axis of the next segment. This requires adapting
<code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">theta</span></code>, if the two rotational axes are not parallel.</p></li>
<li><p>The length of moving along the next segment’s rotational axis is calculated by intersecting
the next rotational axis with the XY-plane of the moved <code class="docutils literal notranslate"><span class="pre">_d</span></code> frame. This gets subtracted from
the next joint’s <code class="docutils literal notranslate"><span class="pre">d</span></code> parameter.</p></li>
</ul>
<p>Note that the parameters from this model are not strict DH parameters anymore, as the two frames at
the tip of the upper and lower arm have to get an additional rotation to compensate the change of
the arm segment orientation, when the tip is moving along its rotation axis.</p>
<p>The resulting “DH parameters” are then reassembled into six individual transforms that can become
the six frames of the robot’s kinematic chain. This is exported in a yaml representation and gets
read by the description package.</p>
<p>Also, no correction of the visual meshes is performed. Strictly speaking, the visual
model is not 100 % correct, but with a calibrated model and ideal meshes this cannot be achieved and
the inaccuracies introduced by this are considered negligible.</p>
<p>The example as visualized in <a class="reference internal" href="#calibration-example"><span class="std std-numref">Fig. 1</span></a> looks as follows if a description with
the correct parameters is loaded:</p>
<figure class="align-default" id="id3">
<img alt="Example with corrected kinematics structure" src="../../../../_images/calibration_example_corrected.png" />
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">This shows the model from <a class="reference internal" href="#calibration-example"><span class="std std-numref">Fig. 1</span></a> with the calibration correction applied.
The robot is correctly assembled and the <code class="docutils literal notranslate"><span class="pre">base-&gt;tool0</span></code> transformation is exactly the same as
on the robot controller.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="usage.html" class="btn btn-neutral float-left" title="Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../ur_controllers/doc/index.html" class="btn btn-neutral float-right" title="ur_controllers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Universal Robots A/S.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>